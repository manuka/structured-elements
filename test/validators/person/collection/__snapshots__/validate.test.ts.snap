// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`validator('Person', 'collection').validate(
  { person0: (Invalid), person1: (Invalid), person2: (Invalid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": {
        "id": "Invalid Person.id-0",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-0.inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-0.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-0.inventory",
                "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-0",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-0",
      "name": "Person.Invalid Person.id-0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-0.inventory",
            "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-0.inventory",
          "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
      },
    },
    {
      "element": {
        "id": "Invalid Person.id-1",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-1.inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-1.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-1.inventory",
                "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-1",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-1",
      "name": "Person.Invalid Person.id-1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-1.inventory",
            "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-1.inventory",
          "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
      },
    },
    {
      "element": {
        "id": "Invalid Person.id-2",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-2.inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-2.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-2.inventory",
                "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-2",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-2",
      "name": "Person.Invalid Person.id-2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-2.inventory",
            "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-2.inventory",
          "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
      },
    },
  ],
  "salvage": {},
  "subject": {
    "Invalid Person.id-0": {
      "id": "Invalid Person.id-0",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Invalid Person.id-1": {
      "id": "Invalid Person.id-1",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Invalid Person.id-2": {
      "id": "Invalid Person.id-2",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Invalid), person1: (Invalid), person2: (Valid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": {
        "id": "Invalid Person.id-0",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-0.inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-0.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-0.inventory",
                "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-0",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-0",
      "name": "Person.Invalid Person.id-0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-0.inventory",
            "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-0.inventory",
          "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-2": {
          "id": "Valid Person.id-2",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
      },
    },
    {
      "element": {
        "id": "Invalid Person.id-1",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-1.inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-1.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-1.inventory",
                "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-1",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-1",
      "name": "Person.Invalid Person.id-1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-1.inventory",
            "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-1.inventory",
          "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-2": {
          "id": "Valid Person.id-2",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
      },
    },
  ],
  "salvage": {
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Invalid Person.id-0": {
      "id": "Invalid Person.id-0",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Invalid Person.id-1": {
      "id": "Invalid Person.id-1",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Invalid), person1: (Invalid), person2: undefined, },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": {
        "id": "Invalid Person.id-0",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-0.inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-0.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-0.inventory",
                "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-0",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-0",
      "name": "Person.Invalid Person.id-0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-0.inventory",
            "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-0.inventory",
          "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person2": undefined,
      },
    },
    {
      "element": {
        "id": "Invalid Person.id-1",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-1.inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-1.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-1.inventory",
                "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-1",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-1",
      "name": "Person.Invalid Person.id-1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-1.inventory",
            "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-1.inventory",
          "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person2": undefined,
      },
    },
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person2",
      "name": "Person.person2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person2",
            "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person2": undefined,
      },
    },
  ],
  "salvage": {},
  "subject": {
    "Invalid Person.id-0": {
      "id": "Invalid Person.id-0",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Invalid Person.id-1": {
      "id": "Invalid Person.id-1",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "person2": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Invalid), person1: (Valid), person2: (Invalid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": {
        "id": "Invalid Person.id-0",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-0.inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-0.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-0.inventory",
                "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-0",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-0",
      "name": "Person.Invalid Person.id-0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-0.inventory",
            "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-0.inventory",
          "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-1": {
          "id": "Valid Person.id-1",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
      },
    },
    {
      "element": {
        "id": "Invalid Person.id-2",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-2.inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-2.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-2.inventory",
                "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-2",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-2",
      "name": "Person.Invalid Person.id-2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-2.inventory",
            "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-2.inventory",
          "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-1": {
          "id": "Valid Person.id-1",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
      },
    },
  ],
  "salvage": {
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Invalid Person.id-0": {
      "id": "Invalid Person.id-0",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Invalid Person.id-2": {
      "id": "Invalid Person.id-2",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Invalid), person1: (Valid), person2: (Valid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": {
        "id": "Invalid Person.id-0",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-0.inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-0.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-0.inventory",
                "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-0",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-0",
      "name": "Person.Invalid Person.id-0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-0.inventory",
            "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-0.inventory",
          "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-1": {
          "id": "Valid Person.id-1",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "Valid Person.id-2": {
          "id": "Valid Person.id-2",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
      },
    },
  ],
  "salvage": {
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Invalid Person.id-0": {
      "id": "Invalid Person.id-0",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Invalid), person1: (Valid), person2: undefined, },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": {
        "id": "Invalid Person.id-0",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-0.inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-0.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-0.inventory",
                "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-0",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-0",
      "name": "Person.Invalid Person.id-0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-0.inventory",
            "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-0.inventory",
          "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-1": {
          "id": "Valid Person.id-1",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person2": undefined,
      },
    },
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person2",
      "name": "Person.person2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person2",
            "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-1": {
          "id": "Valid Person.id-1",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person2": undefined,
      },
    },
  ],
  "salvage": {
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Invalid Person.id-0": {
      "id": "Invalid Person.id-0",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "person2": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Invalid), person1: undefined, person2: (Invalid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": {
        "id": "Invalid Person.id-0",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-0.inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-0.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-0.inventory",
                "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-0",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-0",
      "name": "Person.Invalid Person.id-0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-0.inventory",
            "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-0.inventory",
          "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person1": undefined,
      },
    },
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person1",
      "name": "Person.person1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person1",
            "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person1": undefined,
      },
    },
    {
      "element": {
        "id": "Invalid Person.id-2",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-2.inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-2.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-2.inventory",
                "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-2",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-2",
      "name": "Person.Invalid Person.id-2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-2.inventory",
            "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-2.inventory",
          "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person1": undefined,
      },
    },
  ],
  "salvage": {},
  "subject": {
    "Invalid Person.id-0": {
      "id": "Invalid Person.id-0",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Invalid Person.id-2": {
      "id": "Invalid Person.id-2",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "person1": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Invalid), person1: undefined, person2: (Valid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": {
        "id": "Invalid Person.id-0",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-0.inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-0.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-0.inventory",
                "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-0",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-0",
      "name": "Person.Invalid Person.id-0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-0.inventory",
            "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-0.inventory",
          "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-2": {
          "id": "Valid Person.id-2",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person1": undefined,
      },
    },
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person1",
      "name": "Person.person1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person1",
            "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-2": {
          "id": "Valid Person.id-2",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person1": undefined,
      },
    },
  ],
  "salvage": {
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Invalid Person.id-0": {
      "id": "Invalid Person.id-0",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "person1": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Invalid), person1: undefined, person2: undefined, },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": {
        "id": "Invalid Person.id-0",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-0.inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-0.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-0.inventory",
                "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-0",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-0",
      "name": "Person.Invalid Person.id-0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-0.inventory",
            "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-0.inventory",
          "reason": "Person.Invalid Person.id-0.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person1": undefined,
        "person2": undefined,
      },
    },
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person1",
      "name": "Person.person1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person1",
            "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person1": undefined,
        "person2": undefined,
      },
    },
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person2",
      "name": "Person.person2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person2",
            "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-0": {
          "id": "Invalid Person.id-0",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person1": undefined,
        "person2": undefined,
      },
    },
  ],
  "salvage": {},
  "subject": {
    "Invalid Person.id-0": {
      "id": "Invalid Person.id-0",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "person1": undefined,
    "person2": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Valid), person1: (Invalid), person2: (Invalid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": {
        "id": "Invalid Person.id-1",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-1.inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-1.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-1.inventory",
                "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-1",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-1",
      "name": "Person.Invalid Person.id-1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-1.inventory",
            "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-1.inventory",
          "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-0": {
          "id": "Valid Person.id-0",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
      },
    },
    {
      "element": {
        "id": "Invalid Person.id-2",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-2.inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-2.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-2.inventory",
                "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-2",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-2",
      "name": "Person.Invalid Person.id-2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-2.inventory",
            "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-2.inventory",
          "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-0": {
          "id": "Valid Person.id-0",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
      },
    },
  ],
  "salvage": {
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Invalid Person.id-1": {
      "id": "Invalid Person.id-1",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Invalid Person.id-2": {
      "id": "Invalid Person.id-2",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Valid), person1: (Invalid), person2: (Valid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": {
        "id": "Invalid Person.id-1",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-1.inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-1.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-1.inventory",
                "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-1",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-1",
      "name": "Person.Invalid Person.id-1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-1.inventory",
            "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-1.inventory",
          "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-0": {
          "id": "Valid Person.id-0",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "Valid Person.id-2": {
          "id": "Valid Person.id-2",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
      },
    },
  ],
  "salvage": {
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Invalid Person.id-1": {
      "id": "Invalid Person.id-1",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Valid), person1: (Invalid), person2: undefined, },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": {
        "id": "Invalid Person.id-1",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-1.inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-1.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-1.inventory",
                "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-1",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-1",
      "name": "Person.Invalid Person.id-1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-1.inventory",
            "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-1.inventory",
          "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-0": {
          "id": "Valid Person.id-0",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person2": undefined,
      },
    },
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person2",
      "name": "Person.person2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person2",
            "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-0": {
          "id": "Valid Person.id-0",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person2": undefined,
      },
    },
  ],
  "salvage": {
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Invalid Person.id-1": {
      "id": "Invalid Person.id-1",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "person2": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Valid), person1: (Valid), person2: (Invalid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": {
        "id": "Invalid Person.id-2",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-2.inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-2.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-2.inventory",
                "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-2",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-2",
      "name": "Person.Invalid Person.id-2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-2.inventory",
            "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-2.inventory",
          "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-0": {
          "id": "Valid Person.id-0",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "Valid Person.id-1": {
          "id": "Valid Person.id-1",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
      },
    },
  ],
  "salvage": {
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Invalid Person.id-2": {
      "id": "Invalid Person.id-2",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Valid), person1: (Valid), person2: (Valid), },
  'Person'
) 1`] = `
{
  "failures": [],
  "salvage": {
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "valid": true,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Valid), person1: (Valid), person2: undefined, },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person2",
      "name": "Person.person2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person2",
            "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Valid Person.id-0": {
          "id": "Valid Person.id-0",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "Valid Person.id-1": {
          "id": "Valid Person.id-1",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person2": undefined,
      },
    },
  ],
  "salvage": {
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "person2": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Valid), person1: undefined, person2: (Invalid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person1",
      "name": "Person.person1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person1",
            "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-0": {
          "id": "Valid Person.id-0",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person1": undefined,
      },
    },
    {
      "element": {
        "id": "Invalid Person.id-2",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-2.inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-2.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-2.inventory",
                "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-2",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-2",
      "name": "Person.Invalid Person.id-2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-2.inventory",
            "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-2.inventory",
          "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-0": {
          "id": "Valid Person.id-0",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person1": undefined,
      },
    },
  ],
  "salvage": {
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Invalid Person.id-2": {
      "id": "Invalid Person.id-2",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "person1": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Valid), person1: undefined, person2: (Valid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person1",
      "name": "Person.person1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person1",
            "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Valid Person.id-0": {
          "id": "Valid Person.id-0",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "Valid Person.id-2": {
          "id": "Valid Person.id-2",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person1": undefined,
      },
    },
  ],
  "salvage": {
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "person1": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: (Valid), person1: undefined, person2: undefined, },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person1",
      "name": "Person.person1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person1",
            "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Valid Person.id-0": {
          "id": "Valid Person.id-0",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person1": undefined,
        "person2": undefined,
      },
    },
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person2",
      "name": "Person.person2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person2",
            "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Valid Person.id-0": {
          "id": "Valid Person.id-0",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person1": undefined,
        "person2": undefined,
      },
    },
  ],
  "salvage": {
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Valid Person.id-0": {
      "id": "Valid Person.id-0",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "person1": undefined,
    "person2": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: undefined, person1: (Invalid), person2: (Invalid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person0",
      "name": "Person.person0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person0",
            "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person0": undefined,
      },
    },
    {
      "element": {
        "id": "Invalid Person.id-1",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-1.inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-1.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-1.inventory",
                "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-1",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-1",
      "name": "Person.Invalid Person.id-1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-1.inventory",
            "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-1.inventory",
          "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person0": undefined,
      },
    },
    {
      "element": {
        "id": "Invalid Person.id-2",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-2.inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-2.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-2.inventory",
                "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-2",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-2",
      "name": "Person.Invalid Person.id-2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-2.inventory",
            "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-2.inventory",
          "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person0": undefined,
      },
    },
  ],
  "salvage": {},
  "subject": {
    "Invalid Person.id-1": {
      "id": "Invalid Person.id-1",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Invalid Person.id-2": {
      "id": "Invalid Person.id-2",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "person0": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: undefined, person1: (Invalid), person2: (Valid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person0",
      "name": "Person.person0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person0",
            "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-2": {
          "id": "Valid Person.id-2",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person0": undefined,
      },
    },
    {
      "element": {
        "id": "Invalid Person.id-1",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-1.inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-1.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-1.inventory",
                "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-1",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-1",
      "name": "Person.Invalid Person.id-1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-1.inventory",
            "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-1.inventory",
          "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-2": {
          "id": "Valid Person.id-2",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person0": undefined,
      },
    },
  ],
  "salvage": {
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Invalid Person.id-1": {
      "id": "Invalid Person.id-1",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "person0": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: undefined, person1: (Invalid), person2: undefined, },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person0",
      "name": "Person.person0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person0",
            "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person0": undefined,
        "person2": undefined,
      },
    },
    {
      "element": {
        "id": "Invalid Person.id-1",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-1.inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-1.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-1.inventory",
                "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-1",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-1",
      "name": "Person.Invalid Person.id-1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-1.inventory",
            "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-1.inventory",
          "reason": "Person.Invalid Person.id-1.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person0": undefined,
        "person2": undefined,
      },
    },
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person2",
      "name": "Person.person2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person2",
            "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-1": {
          "id": "Invalid Person.id-1",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person0": undefined,
        "person2": undefined,
      },
    },
  ],
  "salvage": {},
  "subject": {
    "Invalid Person.id-1": {
      "id": "Invalid Person.id-1",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "person0": undefined,
    "person2": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: undefined, person1: (Valid), person2: (Invalid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person0",
      "name": "Person.person0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person0",
            "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-1": {
          "id": "Valid Person.id-1",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person0": undefined,
      },
    },
    {
      "element": {
        "id": "Invalid Person.id-2",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-2.inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-2.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-2.inventory",
                "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-2",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-2",
      "name": "Person.Invalid Person.id-2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-2.inventory",
            "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-2.inventory",
          "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "Valid Person.id-1": {
          "id": "Valid Person.id-1",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person0": undefined,
      },
    },
  ],
  "salvage": {
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Invalid Person.id-2": {
      "id": "Invalid Person.id-2",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "person0": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: undefined, person1: (Valid), person2: (Valid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person0",
      "name": "Person.person0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person0",
            "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Valid Person.id-1": {
          "id": "Valid Person.id-1",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "Valid Person.id-2": {
          "id": "Valid Person.id-2",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person0": undefined,
      },
    },
  ],
  "salvage": {
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "person0": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: undefined, person1: (Valid), person2: undefined, },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person0",
      "name": "Person.person0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person0",
            "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Valid Person.id-1": {
          "id": "Valid Person.id-1",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person0": undefined,
        "person2": undefined,
      },
    },
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person2",
      "name": "Person.person2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person2",
            "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Valid Person.id-1": {
          "id": "Valid Person.id-1",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person0": undefined,
        "person2": undefined,
      },
    },
  ],
  "salvage": {
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Valid Person.id-1": {
      "id": "Valid Person.id-1",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "person0": undefined,
    "person2": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: undefined, person1: undefined, person2: (Invalid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person0",
      "name": "Person.person0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person0",
            "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person0": undefined,
        "person1": undefined,
      },
    },
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person1",
      "name": "Person.person1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person1",
            "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person0": undefined,
        "person1": undefined,
      },
    },
    {
      "element": {
        "id": "Invalid Person.id-2",
        "inventory": undefined,
        "name": "Invalid Person.name",
      },
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "_StructuredElementReference": {
              "structure": "array",
              "target": "Thing",
            },
          },
          "failures": [
            {
              "element": undefined,
              "expectation": {
                "id": "string",
                "name": "string",
                "parts": {
                  "_StructuredElementReference": {
                    "structure": "collection",
                    "target": "Thing",
                  },
                },
                "type": {
                  "_StructuredElementReference": {
                    "structure": "item",
                    "target": [Function],
                  },
                },
                "weight": [
                  "number",
                  null,
                ],
              },
              "key": "(subject)",
              "name": "Person.Invalid Person.id-2.inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "subject": undefined,
            },
          ],
          "key": "inventory",
          "name": "Person.Invalid Person.id-2.inventory",
          "reason": [
            {
              "expectation": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "failure": {
                "element": undefined,
                "expectation": {
                  "id": "string",
                  "name": "string",
                  "parts": {
                    "_StructuredElementReference": {
                      "structure": "collection",
                      "target": "Thing",
                    },
                  },
                  "type": {
                    "_StructuredElementReference": {
                      "structure": "item",
                      "target": [Function],
                    },
                  },
                  "weight": [
                    "number",
                    null,
                  ],
                },
                "key": "(subject)",
                "name": "Person.Invalid Person.id-2.inventory",
                "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
                "subject": undefined,
              },
              "path": "inventory",
              "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
              "value": undefined,
            },
          ],
          "subject": {
            "id": "Invalid Person.id-2",
            "inventory": undefined,
            "name": "Invalid Person.name",
          },
        },
      ],
      "key": "Invalid Person.id-2",
      "name": "Person.Invalid Person.id-2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "name": "string",
              "parts": {
                "_StructuredElementReference": {
                  "structure": "collection",
                  "target": "Thing",
                },
              },
              "type": {
                "_StructuredElementReference": {
                  "structure": "item",
                  "target": [Function],
                },
              },
              "weight": [
                "number",
                null,
              ],
            },
            "key": "(subject)",
            "name": "Person.Invalid Person.id-2.inventory",
            "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
            "subject": undefined,
          },
          "path": "Invalid Person.id-2.inventory",
          "reason": "Person.Invalid Person.id-2.inventory expected to be an array, but isn't. It has typeof undefined",
          "value": undefined,
        },
      ],
      "subject": {
        "Invalid Person.id-2": {
          "id": "Invalid Person.id-2",
          "inventory": undefined,
          "name": "Invalid Person.name",
        },
        "person0": undefined,
        "person1": undefined,
      },
    },
  ],
  "salvage": {},
  "subject": {
    "Invalid Person.id-2": {
      "id": "Invalid Person.id-2",
      "inventory": undefined,
      "name": "Invalid Person.name",
    },
    "person0": undefined,
    "person1": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: undefined, person1: undefined, person2: (Valid), },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person0",
      "name": "Person.person0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person0",
            "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Valid Person.id-2": {
          "id": "Valid Person.id-2",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person0": undefined,
        "person1": undefined,
      },
    },
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person1",
      "name": "Person.person1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person1",
            "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "Valid Person.id-2": {
          "id": "Valid Person.id-2",
          "inventory": [
            {
              "id": "Valid Thing.id",
              "name": "Valid Thing.name",
              "parts": {},
              "type": "gadget",
              "weight": 1,
            },
          ],
          "name": "Valid Person.name",
        },
        "person0": undefined,
        "person1": undefined,
      },
    },
  ],
  "salvage": {
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
  },
  "subject": {
    "Valid Person.id-2": {
      "id": "Valid Person.id-2",
      "inventory": [
        {
          "id": "Valid Thing.id",
          "name": "Valid Thing.name",
          "parts": {},
          "type": "gadget",
          "weight": 1,
        },
      ],
      "name": "Valid Person.name",
    },
    "person0": undefined,
    "person1": undefined,
  },
  "valid": false,
}
`;

exports[`validator('Person', 'collection').validate(
  { person0: undefined, person1: undefined, person2: undefined, },
  'Person'
) 1`] = `
{
  "failures": [
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person0",
      "name": "Person.person0",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person0",
            "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person0",
          "reason": "Person.person0 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "person0": undefined,
        "person1": undefined,
        "person2": undefined,
      },
    },
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person1",
      "name": "Person.person1",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person1",
            "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person1",
          "reason": "Person.person1 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "person0": undefined,
        "person1": undefined,
        "person2": undefined,
      },
    },
    {
      "element": undefined,
      "expectation": {
        "id": "string",
        "inventory": {
          "_StructuredElementReference": {
            "structure": "array",
            "target": "Thing",
          },
        },
        "name": "string",
        "roleId": [
          "number",
          undefined,
        ],
      },
      "failures": [
        {
          "element": undefined,
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "key": "(subject)",
          "name": "Person.person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "subject": undefined,
        },
      ],
      "key": "person2",
      "name": "Person.person2",
      "reason": [
        {
          "expectation": {
            "id": "string",
            "inventory": {
              "_StructuredElementReference": {
                "structure": "array",
                "target": "Thing",
              },
            },
            "name": "string",
            "roleId": [
              "number",
              undefined,
            ],
          },
          "failure": {
            "element": undefined,
            "expectation": {
              "id": "string",
              "inventory": {
                "_StructuredElementReference": {
                  "structure": "array",
                  "target": "Thing",
                },
              },
              "name": "string",
              "roleId": [
                "number",
                undefined,
              ],
            },
            "key": "(subject)",
            "name": "Person.person2",
            "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
            "subject": undefined,
          },
          "path": "person2",
          "reason": "Person.person2 expected to be a string-keyed record, but it isn't. It has typeof 'undefined'.",
          "value": undefined,
        },
      ],
      "subject": {
        "person0": undefined,
        "person1": undefined,
        "person2": undefined,
      },
    },
  ],
  "salvage": {},
  "subject": {
    "person0": undefined,
    "person1": undefined,
    "person2": undefined,
  },
  "valid": false,
}
`;
